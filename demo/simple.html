<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script>

        function renderPoint(
            svg,
            coords,
            fill = "red",
            r = "1%",
            opacity = "1",
            title = '',
            render = true,
            id = "",
            className = ""
        ) {
            if (Array.isArray(coords)) {
                coords = {
                    x: coords[0],
                    y: coords[1]
                };
            }
            let marker = `<circle class="${className}" opacity="${opacity}" id="${id}" cx="${coords.x}" cy="${coords.y}" r="${r}" fill="${fill}">
  <title>${title}</title></circle>`;

            if (render) {
                svg.insertAdjacentHTML("beforeend", marker);
            } else {
                return marker;
            }
        }

    </script>

<!-- 
    <script src="https://cdn.jsdelivr.net/npm/svg-getpointatlength@latest/getPointAtLengthLookup.js"></script>
        
    -->
    
    <script src="../dist/svg-getpointatlength.js"></script>





</head>

<body>


    <svg id="svg" viewBox="-9.5367431640625e-7 0 100 100">
        <path id="path" class="previewPath" d="
       m 50,0 .00001.0001.001 10e-10 Q 36.4 0 24.8 6.8t-18 18  t-6.8 25.2 C 0 63.8 5.6 76.3 14.65 85.35 s 21.55 14.65 35.35 14.65 a 50 25-45 0115.8-34.3 50 25 -45 0134.2 -25.7h -20-.5 v -12.5-12.5 H 75 50 V 0 z M 40 60 h-20 V 20h 18 .5.5.5.5z   m-5-35 c0 10 0 15 0 30 q-5 0 -10 0v-30zh-10 v20 h 5" />


    </svg>



    <script>

        let d = path.getAttribute('d');



        // test pt object - 371.8177265959265
        let ptArr = [[{ x: 4, y: 34.5 }, { x: 6.021, y: 31 }, { x: 8.042, y: 27.5 }, { x: 10.063, y: 24 }, { x: 12.084, y: 20.501 }, { x: 14.104, y: 17 }, { x: 16.125, y: 13.5 }, { x: 18.146, y: 10 }, { x: 22.187, y: 10 }, { x: 26.229, y: 10 }, { x: 30.271, y: 10 }, { x: 34.313, y: 10 }, { x: 32.292, y: 13.5 }, { x: 30.269, y: 17 }, { x: 26.227, y: 17 }, { x: 22.185, y: 17 }, { x: 20.164, y: 20.5 }, { x: 18.145, y: 24 }, { x: 16.124, y: 27.5 }, { x: 14.103, y: 31 }, { x: 12.082, y: 34.5 }, { x: 14.103, y: 38 }, { x: 16.124, y: 41.5 }, { x: 18.145, y: 45 }, { x: 22.187, y: 45 }, { x: 26.228, y: 45 }, { x: 30.27, y: 45 }, { x: 32.291, y: 41.5 }, { x: 34.312, y: 38 }, { x: 36.333, y: 34.5 }, { x: 38.354, y: 31 }, { x: 42.395, y: 31 }, { x: 44.415, y: 34.5 }, { x: 44.415, y: 34.5 }, { x: 44.415, y: 34.5 }, { x: 44.415, y: 34.5 }, { x: 44.415, y: 34.5 }, { x: 42.393, y: 38 }, { x: 40.372, y: 41.5 }, { x: 38.352, y: 45 }, { x: 36.331, y: 48.5 }, { x: 34.311, y: 52 }, { x: 30.269, y: 52 }, { x: 26.228, y: 52 }, { x: 24.207, y: 55.5 }, { x: 22.186, y: 59 }, { x: 18.145, y: 59 }, { x: 16.124, y: 55.5 }, { x: 14.104, y: 52 }, { x: 12.083, y: 48.5 }, { x: 10.062, y: 45 }, { x: 8.041, y: 41.5 }, { x: 6.021, y: 38 }], [{ x: 20.165, y: 34.5 }, { x: 22.186, y: 38 }, { x: 26.228, y: 38 }, { x: 28.249, y: 34.5 }, { x: 30.27, y: 31 }, { x: 32.291, y: 27.5 }, { x: 34.312, y: 24 }, { x: 38.353, y: 24 }, { x: 42.394, y: 24 }, { x: 46.436, y: 24 }, { x: 48.457, y: 27.5 }, { x: 50.478, y: 31 }, { x: 52.497, y: 34.5 }, { x: 50.477, y: 38 }, { x: 48.456, y: 41.5 }, { x: 46.435, y: 45 }, { x: 44.414, y: 48.5 }, { x: 42.393, y: 52 }, { x: 40.372, y: 55.5 }, { x: 38.352, y: 59 }, { x: 42.393, y: 59 }, { x: 46.435, y: 59 }, { x: 48.456, y: 55.5 }, { x: 50.477, y: 52 }, { x: 52.496, y: 48.5 }, { x: 54.517, y: 45 }, { x: 56.538, y: 41.5 }, { x: 58.558, y: 38 }, { x: 60.579, y: 34.5 }, { x: 58.559, y: 31 }, { x: 58.559, y: 31 }, { x: 56.539, y: 27.5 }, { x: 54.518, y: 24 }, { x: 52.497, y: 20.5 }, { x: 50.477, y: 17 }, { x: 48.456, y: 13.5 }, { x: 46.435, y: 10 }, { x: 42.393, y: 10 }, { x: 40.372, y: 13.5 }, { x: 38.352, y: 17 }, { x: 34.31, y: 17 }, { x: 30.269, y: 17 }, { x: 28.248, y: 20.5 }, { x: 26.228, y: 24 }, { x: 24.207, y: 27.5 }, { x: 22.186, y: 31 }]];



        // flat pt arr
        ptArr = '4 34.5 6.021 31 8.042 27.5 10.063 24 12.084 20.501 14.104 17 16.125 13.5 18.146 10 22.187 10 26.229 10 30.271 10 34.313 10 32.292 13.5 30.269 17 26.227 17 22.185 17 20.164 20.5 18.145 24 16.124 27.5 14.103 31 12.082 34.5 14.103 38 16.124 41.5 18.145 45 22.187 45 26.228 45 30.27 45 32.291 41.5 34.312 38 36.333 34.5 38.354 31 42.395 31 44.415 34.5 44.415 34.5 44.415 34.5 44.415 34.5 44.415 34.5 42.393 38 40.372 41.5 38.352 45 36.331 48.5 34.311 52 30.269 52 26.228 52 24.207 55.5 22.186 59 18.145 59 16.124 55.5 14.104 52 12.083 48.5 10.062 45 8.041 41.5 6.021 38 20.165 34.5 22.186 38 26.228 38 28.249 34.5 30.27 31 32.291 27.5 34.312 24 38.353 24 42.394 24 46.436 24 48.457 27.5 50.478 31 52.497 34.5 50.477 38 48.456 41.5 46.435 45 44.414 48.5 42.393 52 40.372 55.5 38.352 59 42.393 59 46.435 59 48.456 55.5 50.477 52 52.496 48.5 54.517 45 56.538 41.5 58.558 38 60.579 34.5 58.559 31 58.559 31 56.539 27.5 54.518 24 52.497 20.5 50.477 17 48.456 13.5 46.435 10 42.393 10 40.372 13.5 38.352 17 34.31 17 30.269 17 28.248 20.5 26.228 24 24.207 27.5 22.186 31'.split(' ').map(Number)


        // pt string
        ptArr = '4 34.5 6.021 31 8.042 27.5 10.063 24 12.084 20.501 14.104 17 16.125 13.5 18.146 10 22.187 10 26.229 10 30.271 10 34.313 10 32.292 13.5 30.269 17 26.227 17 22.185 17 20.164 20.5 18.145 24 16.124 27.5 14.103 31 12.082 34.5 14.103 38 16.124 41.5 18.145 45 22.187 45 26.228 45 30.27 45 32.291 41.5 34.312 38 36.333 34.5 38.354 31 42.395 31 44.415 34.5 44.415 34.5 44.415 34.5 44.415 34.5 44.415 34.5 42.393 38 40.372 41.5 38.352 45 36.331 48.5 34.311 52 30.269 52 26.228 52 24.207 55.5 22.186 59 18.145 59 16.124 55.5 14.104 52 12.083 48.5 10.062 45 8.041 41.5 6.021 38 20.165 34.5 22.186 38 26.228 38 28.249 34.5 30.27 31 32.291 27.5 34.312 24 38.353 24 42.394 24 46.436 24 48.457 27.5 50.478 31 52.497 34.5 50.477 38 48.456 41.5 46.435 45 44.414 48.5 42.393 52 40.372 55.5 38.352 59 42.393 59 46.435 59 48.456 55.5 50.477 52 52.496 48.5 54.517 45 56.538 41.5 58.558 38 60.579 34.5 58.559 31 58.559 31 56.539 27.5 54.518 24 52.497 20.5 50.477 17 48.456 13.5 46.435 10 42.393 10 40.372 13.5 38.352 17 34.31 17 30.269 17 28.248 20.5 26.228 24 24.207 27.5 22.186 31'

                // no multi
        ptArr = [[4, 34.5], [6.021, 31], [8.042, 27.5], [10.063, 24], [12.084, 20.501], [14.104, 17], [16.125, 13.5], [18.146, 10], [22.187, 10], [26.229, 10], [30.271, 10], [34.313, 10], [32.292, 13.5], [30.269, 17], [26.227, 17], [22.185, 17], [20.164, 20.5], [18.145, 24], [16.124, 27.5], [14.103, 31], [12.082, 34.5], [14.103, 38], [16.124, 41.5], [18.145, 45], [22.187, 45], [26.228, 45], [30.27, 45], [32.291, 41.5], [34.312, 38], [36.333, 34.5], [38.354, 31], [42.395, 31], [44.415, 34.5], [44.415, 34.5], [44.415, 34.5], [44.415, 34.5], [44.415, 34.5], [42.393, 38], [40.372, 41.5], [38.352, 45], [36.331, 48.5], [34.311, 52], [30.269, 52], [26.228, 52], [24.207, 55.5], [22.186, 59], [18.145, 59], [16.124, 55.5], [14.104, 52], [12.083, 48.5], [10.062, 45], [8.041, 41.5], [6.021, 38], [20.165, 34.5], [22.186, 38], [26.228, 38], [28.249, 34.5], [30.27, 31], [32.291, 27.5], [34.312, 24], [38.353, 24], [42.394, 24], [46.436, 24], [48.457, 27.5], [50.478, 31], [52.497, 34.5], [50.477, 38], [48.456, 41.5], [46.435, 45], [44.414, 48.5], [42.393, 52], [40.372, 55.5], [38.352, 59], [42.393, 59], [46.435, 59], [48.456, 55.5], [50.477, 52], [52.496, 48.5], [54.517, 45], [56.538, 41.5], [58.558, 38], [60.579, 34.5], [58.559, 31], [58.559, 31], [56.539, 27.5], [54.518, 24], [52.497, 20.5], [50.477, 17], [48.456, 13.5], [46.435, 10], [42.393, 10], [40.372, 13.5], [38.352, 17], [34.31, 17], [30.269, 17], [28.248, 20.5], [26.228, 24], [24.207, 27.5], [22.186, 31]]



        //multi poly pt value arr
        ptArr = [[[4, 34.5], [6.021, 31], [8.042, 27.5], [10.063, 24], [12.084, 20.501], [14.104, 17], [16.125, 13.5], [18.146, 10], [22.187, 10], [26.229, 10], [30.271, 10], [34.313, 10], [32.292, 13.5], [30.269, 17], [26.227, 17], [22.185, 17], [20.164, 20.5], [18.145, 24], [16.124, 27.5], [14.103, 31], [12.082, 34.5], [14.103, 38], [16.124, 41.5], [18.145, 45], [22.187, 45], [26.228, 45], [30.27, 45], [32.291, 41.5], [34.312, 38], [36.333, 34.5], [38.354, 31], [42.395, 31], [44.415, 34.5], [44.415, 34.5], [44.415, 34.5], [44.415, 34.5], [44.415, 34.5], [42.393, 38], [40.372, 41.5], [38.352, 45], [36.331, 48.5], [34.311, 52], [30.269, 52], [26.228, 52], [24.207, 55.5], [22.186, 59], [18.145, 59], [16.124, 55.5], [14.104, 52], [12.083, 48.5], [10.062, 45], [8.041, 41.5], [6.021, 38]], [[20.165, 34.5], [22.186, 38], [26.228, 38], [28.249, 34.5], [30.27, 31], [32.291, 27.5], [34.312, 24], [38.353, 24], [42.394, 24], [46.436, 24], [48.457, 27.5], [50.478, 31], [52.497, 34.5], [50.477, 38], [48.456, 41.5], [46.435, 45], [44.414, 48.5], [42.393, 52], [40.372, 55.5], [38.352, 59], [42.393, 59], [46.435, 59], [48.456, 55.5], [50.477, 52], [52.496, 48.5], [54.517, 45], [56.538, 41.5], [58.558, 38], [60.579, 34.5], [58.559, 31], [58.559, 31], [56.539, 27.5], [54.518, 24], [52.497, 20.5], [50.477, 17], [48.456, 13.5], [46.435, 10], [42.393, 10], [40.372, 13.5], [38.352, 17], [34.31, 17], [30.269, 17], [28.248, 20.5], [26.228, 24], [24.207, 27.5], [22.186, 31]]]



ptArr = [[{ x: 4, y: 34.5 }, { x: 6.021, y: 31 }, { x: 8.042, y: 27.5 }, { x: 10.063, y: 24 }, { x: 12.084, y: 20.501 }, { x: 14.104, y: 17 }, { x: 16.125, y: 13.5 }, { x: 18.146, y: 10 }, { x: 22.187, y: 10 }, { x: 26.229, y: 10 }, { x: 30.271, y: 10 }, { x: 34.313, y: 10 }, { x: 32.292, y: 13.5 }, { x: 30.269, y: 17 }, { x: 26.227, y: 17 }, { x: 22.185, y: 17 }, { x: 20.164, y: 20.5 }, { x: 18.145, y: 24 }, { x: 16.124, y: 27.5 }, { x: 14.103, y: 31 }, { x: 12.082, y: 34.5 }, { x: 14.103, y: 38 }, { x: 16.124, y: 41.5 }, { x: 18.145, y: 45 }, { x: 22.187, y: 45 }, { x: 26.228, y: 45 }, { x: 30.27, y: 45 }, { x: 32.291, y: 41.5 }, { x: 34.312, y: 38 }, { x: 36.333, y: 34.5 }, { x: 38.354, y: 31 }, { x: 42.395, y: 31 }, { x: 44.415, y: 34.5 }, { x: 44.415, y: 34.5 }, { x: 44.415, y: 34.5 }, { x: 44.415, y: 34.5 }, { x: 44.415, y: 34.5 }, { x: 42.393, y: 38 }, { x: 40.372, y: 41.5 }, { x: 38.352, y: 45 }, { x: 36.331, y: 48.5 }, { x: 34.311, y: 52 }, { x: 30.269, y: 52 }, { x: 26.228, y: 52 }, { x: 24.207, y: 55.5 }, { x: 22.186, y: 59 }, { x: 18.145, y: 59 }, { x: 16.124, y: 55.5 }, { x: 14.104, y: 52 }, { x: 12.083, y: 48.5 }, { x: 10.062, y: 45 }, { x: 8.041, y: 41.5 }, { x: 6.021, y: 38 }], [{ x: 20.165, y: 34.5 }, { x: 22.186, y: 38 }, { x: 26.228, y: 38 }, { x: 28.249, y: 34.5 }, { x: 30.27, y: 31 }, { x: 32.291, y: 27.5 }, { x: 34.312, y: 24 }, { x: 38.353, y: 24 }, { x: 42.394, y: 24 }, { x: 46.436, y: 24 }, { x: 48.457, y: 27.5 }, { x: 50.478, y: 31 }, { x: 52.497, y: 34.5 }, { x: 50.477, y: 38 }, { x: 48.456, y: 41.5 }, { x: 46.435, y: 45 }, { x: 44.414, y: 48.5 }, { x: 42.393, y: 52 }, { x: 40.372, y: 55.5 }, { x: 38.352, y: 59 }, { x: 42.393, y: 59 }, { x: 46.435, y: 59 }, { x: 48.456, y: 55.5 }, { x: 50.477, y: 52 }, { x: 52.496, y: 48.5 }, { x: 54.517, y: 45 }, { x: 56.538, y: 41.5 }, { x: 58.558, y: 38 }, { x: 60.579, y: 34.5 }, { x: 58.559, y: 31 }, { x: 58.559, y: 31 }, { x: 56.539, y: 27.5 }, { x: 54.518, y: 24 }, { x: 52.497, y: 20.5 }, { x: 50.477, y: 17 }, { x: 48.456, y: 13.5 }, { x: 46.435, y: 10 }, { x: 42.393, y: 10 }, { x: 40.372, y: 13.5 }, { x: 38.352, y: 17 }, { x: 34.31, y: 17 }, { x: 30.269, y: 17 }, { x: 28.248, y: 20.5 }, { x: 26.228, y: 24 }, { x: 24.207, y: 27.5 }, { x: 22.186, y: 31 }]];

// nonsense

//ptArr = []

        //d = ptArr;

        // test svg element
        //d = path.closest('svg').outerHTML;


        
        if (SVGPathElement.prototype.getPathData !== undefined) {
            console.log('native support');

            let pathDataN = path.getPathData();
            let type = typeof pathDataN;

            //console.log(pathDataN);
            //d=pathDataN;
        }

        /*
        // repeat pathdata for testing
        let r = 0;
        for (let i = 0; i < r; i++) {
            d += d
        }
        */

        let precision= 'medium';
        let t0 = performance.now()
        let lookup = getPathLengthLookup(d, precision);
        let t1 = performance.now() - t0


        let len = 270
        let pt = lookup.getPointAtLength(len)

        //let lenS = getPathLengthFromD(d);
        //console.log('lenS', lenS);
        console.log('ms', t1, lookup);


        let ptN = path.getPointAtLength(len)

        //let segment = lookup.getSegmentAtLength(len)
        //console.log('segment', segment);

        renderPoint(svg, pt, 'green', '1.5%')
        renderPoint(svg, ptN)


    </script>

</body>

</html>